id: exploration-process
version: "1.0.0"
name: Exploration Process
description: Minimal exploration loop with artifact guards and tool permissions
initial_state: frame

states:
  - name: frame
    description: Frame the problem and form hypothesis
    prompt: |
      Frame the problem and form a hypothesis.

      Create `evidence/hypothesis.md` with:
      - Problem statement
      - Initial hypothesis
      - Expected outcome

      When ready, emit 'submit_hypothesis' event with the artifact path.
    required_artifacts:
      - path: evidence/hypothesis.md
    tool_permissions:
      allowed: [Read, Glob, Grep, Write, WebSearch, WebFetch]
      denied: [Edit, Bash]

  - name: experiment
    description: Plan experiments to test hypothesis
    prompt: |
      Design experiments to test your hypothesis.

      Create `evidence/experiment_plan.md` with:
      - Experiment steps
      - What to observe
      - Success criteria

      When ready, emit 'submit_experiment_plan' event with the artifact path.
    required_artifacts:
      - path: evidence/experiment_plan.md
    tool_permissions:
      allowed: [Read, Glob, Grep, Write]
      denied: [Edit, Bash]

  - name: observe
    description: Execute experiments and record observations
    prompt: |
      Execute your experiments and record observations.

      Create `evidence/observation.md` with:
      - What you did
      - What you observed
      - Raw data/results

      When ready, emit 'submit_observation' event with the artifact path.
    required_artifacts:
      - path: evidence/observation.md
    tool_permissions:
      allowed: [Read, Glob, Grep, Write, Bash]
      ask: [Edit]

  - name: synthesize
    description: Synthesize findings and draw conclusions
    prompt: |
      Analyze your observations and synthesize findings.

      Create `evidence/synthesis.md` with:
      - Key findings
      - Hypothesis validation (confirmed/rejected)
      - Insights gained
      - Next steps recommendation

      When ready, emit 'submit_synthesis' event with the artifact path.
    required_artifacts:
      - path: evidence/synthesis.md
    tool_permissions:
      allowed: [Read, Glob, Grep, Write]

  - name: decide
    description: Decide next step - iterate or complete
    prompt: |
      Review the synthesis and decide:

      - **Iterate**: Go back to 'frame' to refine hypothesis (emit 'iterate')
      - **Complete**: Finalize exploration (emit 'finalize')

      The decision is typically made by a human or approval gate.
    tool_permissions:
      allowed: [Read]

  - name: complete
    description: Exploration complete
    prompt: |
      Exploration completed successfully.

      All artifacts are available in the evidence/ directory.
    is_final: true
    tool_permissions:
      allowed: [Read]

events:
  - name: submit_hypothesis
    description: Submit hypothesis document
    allowed_roles: [agent, human]

  - name: submit_experiment_plan
    description: Submit experiment plan document
    allowed_roles: [agent, human]

  - name: submit_observation
    description: Submit observation record
    allowed_roles: [agent, human]

  - name: submit_synthesis
    description: Submit synthesis document
    allowed_roles: [agent, human]

  - name: iterate
    description: Iterate the exploration loop
    allowed_roles: [human]

  - name: finalize
    description: Finalize and complete exploration
    allowed_roles: [human]

transitions:
  - from: frame
    event: submit_hypothesis
    to: experiment
    guards:
      - type: artifact_exists
        paths: ["evidence/hypothesis.md"]

  - from: experiment
    event: submit_experiment_plan
    to: observe
    guards:
      - type: artifact_exists
        paths: ["evidence/experiment_plan.md"]

  - from: observe
    event: submit_observation
    to: synthesize
    guards:
      - type: artifact_exists
        paths: ["evidence/observation.md"]

  - from: synthesize
    event: submit_synthesis
    to: decide
    guards:
      - type: artifact_exists
        paths: ["evidence/synthesis.md"]

  - from: decide
    event: iterate
    to: frame

  - from: decide
    event: finalize
    to: complete
    guards:
      - type: artifact_exists
        paths: ["evidence/synthesis.md"]

roles:
  - name: agent
    description: AI agent performing exploration
    allowed_events: [submit_hypothesis, submit_experiment_plan, submit_observation, submit_synthesis]

  - name: human
    description: Human supervisor
    allowed_events: [submit_hypothesis, submit_experiment_plan, submit_observation, submit_synthesis, iterate, finalize]
